<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>{{post.title}}</title>

	<!-- Bootstrap Core CSS -->
	<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

	<!-- Theme CSS -->
	<link href="css/clean-blog.min.css" rel="stylesheet">

	<!-- Custom Fonts -->
	<link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->
	<script type="text/javascript">
		function passModalData(comment_id) {
			var modal_input = document.getElementById('edit-comment-modal-input');
			modal_input.value = comment_id;

			var modal_textarea = document.getElementById('edit-comment-textarea');
			modal_textarea.innerHTML = document.getElementById('comment:' + comment_id).innerHTML;
		}

		function deleteCommentHelper(comment_id) {
			var modal_input = document.getElementById('delete-comment-button-hidden-input');
			modal_input.value = comment_id;
		}
	</script>

</head>

<body>

	<!-- Navigation -->
	<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
		<div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header page-scroll">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					Menu <i class="fa fa-bars"></i>
				</button>
				<a class="navbar-brand" href="/">Connor's Blog</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav navbar-right">
					<li>
						<a href="/">Home</a>
					</li>
					{% if user %}
						<li>
							<a href="post">Post</a>
						</li>
						<li>
							<a class="login-link" href="/logout">logout</a>
						</li>
					{% else %}
						<li>
							<a href="register">Register</a>
						</li>
						<li>
							<a href="login">Login</a>
						</li>
					{% endif %}
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
	</nav>

	<!-- Page Header -->
	<!-- Set your background image for this header on the line below. -->
	<header class="intro-header" style="background-image: url('img/about-bg.jpg')">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
					<div class="page-heading">
						<h1>{{ post.title }}</h1>
						<h4>{{ post.username }} | {{ post.created.date() }}</h4>
					</div>
				</div>
			</div>
		</div>
	</header>

	<!-- Main Content -->
	<div class="container">
		<div class="row">
			<p></p>
			<div class="col-lg-10">
				{{ post.post_content }}
			</div>
			{% if post.username|string() == user.name|string() %}
				<div class="btn-group btn-group-sm col-md-2">
					<button class="btn btn-default" data-toggle="modal" data-target="#delete-post-modal">
						<span class="glyphicon glyphicon-trash"></span>
					</button>
					<button class="btn btn-default" data-toggle="modal" data-target="#edit-post-modal">
						<span class="glyphicon glyphicon-pencil"></span>
					</button>
				</div>
			{% endif %}
		</div>
		<div class="row">
			<div class="col-lg-8">
				<h3>Comments</h3>
				<hr class="small">
				{% for comment in comments %}
					<div>
						<div class="comment">
							<h4> {{comment.username}} </h4>
							<p id="comment:{{comment.key()}}"> {{comment.comment_text}} </p>
							<p class="text-muted"> {{comment.created.date()}} </p>
							{% if comment.username|string() == user.name|string() %}
								<div class="btn-group btn-group-sm">
									<button class="btn btn-default btn-sm" data-toggle="modal" data-target="#delete-comment-modal" value="{{comment.key()}}" onclick="deleteCommentHelper(this.value)">
										<span class="glyphicon glyphicon-trash"></span>
									</button>
									<button value="{{comment.key()}}" class="btn btn-default btn-sm" data-toggle="modal" data-target="#edit-comment-modal" onclick="passModalData(this.value)">
										<span class="glyphicon glyphicon-pencil"></span>
									</button>
								</div>
							{% endif %}
						</div>
						<br>
					</div>
				{% endfor %}
			</div>
		</div>
		<!-- Trigger the add comment modal with a button -->
		{% if user %}
			<div class="row">
				<div class="col-lg-2">
				<hr class="small">
					<button type="button" class="btn btn-info btn-md" data-toggle="modal" data-target="#add-comment-modal">Add Comment</button>
				</div>
				{% if post.username|string() != user.name|string() %}
					<div class="col-lg-1">
					<hr class="small">
						<form method="post">
							<input type="hidden" name="action" value="like-click">
							{% if user.name|string() in post.likers %}
								<button type="submit" class="btn btn-info btn-md" name="username" value="{{user.name}}">
									<span class="glyphicon glyphicon-thumbs-down"></span>
									{{post.likes}}
								</button>
							{% else %}
								<button type="submit" class="btn btn-info btn-md" name="username" value="{{user.name}}">
									<span class="glyphicon glyphicon-thumbs-up"></span>
									{{post.likes}}
								</button>
							{% endif %}
						</form>
					</div>
				{% endif %}
			</div>
		{% endif %}
	</div>
	<hr>
	<!-- Add Comment Modal -->
	<div class="container-fluid">
		<div id="add-comment-modal" class="modal fade" role="dialog">
			<div class="modal-dialog">
			<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">x</button>
						<h4 class="modal-title">Add Comment</h4>
					</div>
					<div class="modal-body">
						<form name="add-comment-orm" method="post" novalidate>
							<p class="alert-warning">
								{{error}}
							</p>
							<div class="row control-group">
								<div class="form-group col-xs-12 controls">
									<label>Message</label>
									<textarea class="form-control" placeholder="Content" name="comment_text"></textarea>
								</div>
								<input type="hidden" name="post_id={{post.key()}}">
								<input type="hidden" name="action" value="add-comment">
							</div>
							<br>
							<div class="row">
								<div class="form-group col-xs-12">
									<button type="submit" class="btn btn-default">Submit</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Edit Post Modal -->
	<div class="container-fluid">
		<div id="edit-post-modal" class="modal fade" role="dialog">
			<div class="modal-dialog">
			<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">x</button>
						<h4 class="modal-title">Edit Post</h4>
					</div>
					<div class="modal-body">
						<form name="edit-post-form" method="post" novalidate>
							<p class="alert-warning">
								{{error}}
							</p>
							<div class="row control-group">
								<div class="form-group col-xs-12 controls">
									<label>Title</label>
									<input type="text" class="form-control" placeholder="Title" name="edited-title" value="{{post.title}}">
								</div>
							</div>
							<div class="row control-group">
								<div class="form-group col-xs-12 controls">
									<label>Content</label>
									<textarea class="form-control" placeholder="Content" name="edited-content">{{post.post_content}}</textarea>
								</div>
							</div>
							<input type="hidden" name="action" value="edit-post">
							<br>
							<div class="row">
								<div class="form-group col-xs-12">
									<button type="submit" class="btn btn-default">Submit</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Edit Comment Modal -->
	<div class="container-fluid">
		<div id="edit-comment-modal" class="modal fade" role="dialog">
			<div class="modal-dialog">
			<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">x</button>
						<h4 class="modal-title">Edit Comment</h4>
					</div>
					<div class="modal-body">
						<form name="edit-comment-form" method="post" novalidate>
							<p class="alert-warning">
								{{error}}
							</p>
							<div class="row control-group">
								<div class="form-group col-xs-12 controls">
									<label>Comment</label>
									<textarea class="form-control" placeholder="Content" name="edited-comment-text" id="edit-comment-textarea"></textarea>
								</div>
							</div>
							<input type="hidden" name="action" value="edit-comment">
							<input type="hidden" name="comment_id" id="edit-comment-modal-input" value="">
							<br>
							<div class="row">
								<div class="form-group col-xs-12">
									<button type="submit" class="btn btn-default">Submit</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Delete Post Modal -->
	<div class="container-fluid">
		<div id="delete-post-modal" class="modal fade" role="dialog">
			<div class="modal-dialog">
			<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">x</button>
						<h4 class="modal-title">Are you sure you want to delete this post? </h4>
					</div>
					<div class="modal-body">
						<form name="delete-post-form" method="post" novalidate>
							<input type="hidden" name="action" value="delete-post">
							<div class="row">
								<div class="form-group col-xs-12">
									<button type="submit" class="btn btn-danger">Delete</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Delete Comment Modal -->
	<div class="container-fluid">
		<div id="delete-comment-modal" class="modal fade" role="dialog">
			<div class="modal-dialog">
			<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">x</button>
						<h4 class="modal-title">Are you sure you want to delete this comment? </h4>
					</div>
					<div class="modal-body text-center">
						<form name="delete-comment-form" method="post" novalidate>
							<input type="hidden" name="action" value="delete-comment">
							<input type="hidden" id="delete-comment-button-hidden-input" name="comment_id" value="">
							<div class="row">
								<div class="form-group col-xs-12">
									<button type="submit" class="btn btn-danger">Delete</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Footer -->
	<footer>
		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
					<p class="copyright text-muted">Copyright &copy; Connor Callison 2016</p>
				</div>
			</div>
		</div>
	</footer>

	<!-- jQuery -->
	<script src="vendor/jquery/jquery.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>

	<!-- Contact Form JavaScript -->
	<script src="js/jqBootstrapValidation.js"></script>
	<script src="js/contact_me.js"></script>

	<!-- Theme JavaScript -->
	<script src="js/clean-blog.min.js"></script>

</body>

</html>
